"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3345],{32242:function(e,a,s){var t=s(11527),n=s(50959),i=s(70678),c=s(79253),l=s(50337),r=s(80850),o=s(5816),m=s(54312),d=s(54883),u=s(90605),h=s(92310),x=s(5907),f=s(69706),b=s(64376),k=s(23878),j=s(90484),p=s(3131),v=s(19803),N=s.n(v);let w=e=>{let{mode:a="default",id:s,actionData:x={},title:v="",banner:w="",dispatch:y,showShare:g=!1,source:Z,showComment:C=!0,isAuthor:S=!1,sticky:L=!0,style:_={},likeBtnSize:I="lg",showLikeBtn:B=!0,showHateBtn:F=!1,showBookmarkBtn:M=!0,showShareBtn:D=!0,isNotHandle:q={like:!1,hate:!1,haveAccess:!1},isBaiduOxApp:A=!1,realViews:E=0,sessionUser:P,className:T="pt-5",top:R=0,bottomBoundary:U,onLikeCallback:H,onHateCallback:O}=e,{isLiked:K=!1,votes:z=0,bookmarks:W=0,isBookmarked:$=!1,isHated:G=!1,comments:X=0}=x,[J,Q]=(0,n.useState)(z),[V,Y]=(0,n.useState)(G),[ee,ea]=(0,n.useState)(W),[es,et]=(0,n.useState)(K),[en,ei]=(0,n.useState)($),[ec,el]=(0,n.useState)(!1),[er,eo]=(0,n.useState)(""),[em,ed]=(0,n.useState)(""),[eu,eh]=(0,n.useState)(""),[ex,ef]=(0,n.useState)(""),[eb,ek]=(0,n.useState)(!1),[ej,ep]=(0,n.useState)(!1),ev=(0,n.useRef)(),eN=(0,n.useRef)(),ew=(0,n.useRef)();(0,n.useEffect)(()=>{var e,a;(null===(e=window.navigator)||void 0===e?void 0:null===(a=e.canShare)||void 0===a?void 0:a.call(e,{text:v}))&&ep(!0)},[]),(0,n.useEffect)(()=>{et(K),ei($),Q(z),ea(W),Y(G)},[K,$,z,W,G]),(0,n.useEffect)(()=>{let e="".concat(window.location.origin).concat(window.location.pathname,"?utm_medium=shareLink&utm_campaign=socialShare");P?eo("".concat(e,"&share_user=").concat(P.user.id)):eo(e),ed("【".concat(v,"】分享自 @segment_fault，传送门：")),eh("【".concat(v,"】分享自 @SegmentFault，传送门："))},[er,P]),(0,n.useEffect)(()=>{if(er&&!ex){let e=null==document?void 0:document.querySelector(".qrcode");f.toCanvas(e,"".concat(er,"&utm_source=Wechat"),{margin:0},function(e,a){e&&console.error(e),ef(a.toDataURL())})}},[ex,er]);let ey=()=>{if(!(0,p.bg)())return;if(q.like){k.ZP.confirm({content:"不能给自己点赞"});return}if(S&&("article"===Z||"video"===Z)){k.ZP.confirm({content:"你是作者，无法对自己进行此操作"});return}if("product-score"===Z&&!q.haveAccess){y({type:"global/saveProductAuthModalState",payload:{isShow:!0,title:"点赞"}});return}let e=V?2:1;Q(es?J-e:J+e),et(!es),Y(!1),y({type:"action/saveLike",payload:{id:s,votes:es?J-e:J+e,isLiked:!es,isHated:!1}}),(0,j.vLC)({id:s,type:Z,is_like:es?0:1}).then(()=>{H&&H(!es)}).catch(()=>{Q(J),et(es),Y(V),y({type:"action/saveLike",payload:{id:s,votes:J,isLiked:es,isHated:V}})})},eg=()=>{(0,p.bg)()&&el(!0)},eZ=e=>{ea(e?ee+1:ee-1),ei(e),y({type:"action/saveBookmark",payload:{id:s,bookmarks:e?ee+1:ee-1,isBookmarked:e}})},eC=()=>{if(!(0,p.bg)())return;if(q.hate){k.ZP.confirm({content:"不能给自己点踩"});return}if("product-score"===Z&&!q.haveAccess){y({type:"global/saveProductAuthModalState",payload:{isShow:!0,title:"点踩"}});return}let e=es?2:1;et(!1),Q(V?J+e:J-e),y({type:"action/saveLike",payload:{id:s,votes:V?J+e:J-e,isLiked:!1,isHated:!V}}),(0,j.qne)({id:s,type:Z,is_hate:V?0:1}).then(()=>{O&&O(!V)}).catch(()=>{Y(V),et(es),Q(J),ek(V),y({type:"action/saveLike",payload:{id:s,votes:J,isLiked:es,isHated:V}})})},eS=()=>{navigator.share({title:v,text:v+"- SegmentFault 思否，传送门：",url:"".concat(window.location.origin).concat(window.location.pathname)})},eL=(0,t.jsx)(i.Z,{id:"popover-basic",children:(0,t.jsx)(i.Z.Body,{children:"如果该内容有可改进的余地，欢迎通过评论给作者建议。"})}),e_=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"text-center mt-2",style:{cursor:"auto"},children:[(0,t.jsx)("div",{className:"qr",children:(0,t.jsx)("img",{crossOrigin:"anonymous",src:ex,width:"118",height:"118"})}),"扫一扫分享"]}),(0,t.jsx)("div",{className:"dropdown-divider"}),(0,t.jsx)(c.Z.Item,{className:"p-0",onKeyDown:e=>{13===e.keyCode&&ev.current.click()},children:(0,t.jsxs)(d.Z,{title:eu,url:"".concat(er,"&utm_source=Weibo"),image:w,ref:ev,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,t.jsx)("i",{className:"fab fa-weibo fa-fw"})," 新浪微博"]})}),(0,t.jsx)(c.Z.Item,{className:"p-0",onKeyDown:e=>{13===e.keyCode&&eN.current.click()},children:(0,t.jsxs)(u.Z,{title:em,url:"".concat(er,"&utm_source=Twitter"),ref:eN,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,t.jsx)("i",{className:"fab fa-twitter fa-fw"})," Twitter"]})}),(0,t.jsx)(c.Z.Item,{className:"p-0",onKeyDown:e=>{13===e.keyCode&&ew.current.click()},children:(0,t.jsxs)(h.Z,{title:em,url:"".concat(er,"&utm_source=Facebook"),ref:ew,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,t.jsx)("i",{className:"fab fa-facebook fa-fw"})," Facebook"]})})]}),eI=null;return"default"===a?eI="article"===Z?(0,t.jsx)(m.Z,{enable:L,top:R,bottomBoundary:U,className:N()("sticky-wrap functional-area-left justify-content-center me-0 ms-0",T),children:(0,t.jsxs)(l.Z,{vertical:!0,className:"align-items-center",children:[B&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Z,{variant:"outline-primary",className:"func-btn mainLike sflex-center shadow-sm rounded-circle main-".concat(I,"-Like ").concat(F?"mb-2":"mb-0"),active:es,onClick:ey,"aria-label":"点赞",children:(0,t.jsx)("i",{className:"far fa-thumbs-up"})}),(0,t.jsx)("span",{className:"text-primary fw-bold ".concat(J>0?"":"invisible"),children:J})]}),F&&(0,t.jsx)(o.Z,{trigger:"click",placement:"right",show:eb,overlay:eL,children:(0,t.jsx)(r.Z,{variant:"outline-secondary",className:"shadow-sm func-btn sflex-center rounded-circle main-".concat(I,"-Like main-hate"),active:V,onClick:eC,onBlur:()=>ek(!1),"aria-label":"点踩",children:(0,t.jsx)("i",{className:"far fa-thumbs-down fa-flip-horizontal"})})}),M&&(0,t.jsx)(r.Z,{variant:"outline-secondary",className:"func-btn sflex-center rounded-circle  mt-2",onClick:eg,active:en,"aria-label":"收藏",children:(0,t.jsx)("i",{className:"far fa-bookmark"})}),C&&(0,t.jsx)("a",{className:"func-btn sflex-center btn btn-outline-secondary rounded-circle",href:"#comment-area","aria-label":"评论",children:(0,t.jsx)("i",{className:"far fa-message-lines"})}),D&&(0,t.jsxs)(c.Z,{children:[(0,t.jsx)(c.Z.Toggle,{className:"func-btn nav-tab-item  rounded-pill btn btn-outline-secondary sflex-center rounded-circle",id:"actions-toggle","aria-label":"分享",children:(0,t.jsx)("i",{className:"far fa-share-nodes"})}),(0,t.jsx)(c.Z.Menu,{className:"dropdown-menu-down",show:g,children:e_})]})]})}):(0,t.jsx)("div",{className:N()("sticky-wrap  functional-area-left d-none d-xl-flex justify-content-center ",T,L&&"sticky-top"),style:_,children:(0,t.jsxs)(l.Z,{vertical:!0,className:"align-items-center",children:[B&&(0,t.jsxs)(r.Z,{variant:"outline-primary",className:"func-btn mainLike sflex-center shadow-sm rounded-circle main-".concat(I,"-Like ").concat(F?"mb-2":"mb-3"),active:es,onClick:ey,"aria-label":"点赞",children:[(0,t.jsx)("i",{className:"far fa-thumbs-up"}),"question"===Z||"answer"===Z||"product-score"===Z?(0,t.jsx)("span",{className:"mainLikeNum ".concat(0!==J?"":"invisible"),children:J}):(0,t.jsx)("span",{className:"mainLikeNum ".concat(J>0?"":"invisible"),children:J})]}),F&&(0,t.jsx)(o.Z,{trigger:"click",placement:"right",show:eb,overlay:eL,children:(0,t.jsx)(r.Z,{variant:"outline-secondary",className:"shadow-sm func-btn sflex-center rounded-circle main-".concat(I,"-Like main-hate mb-3"),active:V,onClick:eC,onBlur:()=>ek(!1),"aria-label":"点踩",children:(0,t.jsx)("i",{className:"far fa-thumbs-down fa-flip-horizontal"})})}),M&&(0,t.jsx)(r.Z,{variant:"outline-secondary",className:"func-btn sflex-center rounded-circle mb-2",onClick:eg,active:en,"aria-label":"收藏",children:(0,t.jsx)("i",{className:"far fa-bookmark"})}),C&&(0,t.jsx)("a",{className:"func-btn sflex-center btn btn-outline-secondary rounded-circle mb-2",href:"#comment-area","aria-label":"评论",children:(0,t.jsx)("i",{className:"far fa-message-lines"})}),D&&(0,t.jsxs)(c.Z,{children:[(0,t.jsx)(c.Z.Toggle,{className:"func-btn nav-tab-item  rounded-pill btn btn-outline-secondary sflex-center rounded-circle",id:"actions-toggle","aria-label":"分享",children:(0,t.jsx)("i",{className:"far fa-share-nodes"})}),(0,t.jsx)(c.Z.Menu,{className:"dropdown-menu-down",show:g,children:e_})]})]})}):"btnGroup"===a?eI=(0,t.jsx)("div",{className:N()("functional-area-bottom text-center",T),children:(0,t.jsxs)(l.Z,{className:"btn-group like-group align-items-center",role:"group",children:[(0,t.jsxs)(r.Z,{className:"btn me-2 rounded",variant:"outline-primary",active:es,onClick:ey,children:[(0,t.jsx)("i",{className:"far fa-thumbs-up"}),(0,t.jsx)("span",{className:"ms-1",children:es?"已赞":"赞"}),J>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:J})]}),M&&(0,t.jsxs)(r.Z,{className:"btn me-2 rounded",variant:"outline-secondary",active:en,onClick:eg,children:[(0,t.jsx)("i",{className:"far fa-bookmark"}),(0,t.jsx)("span",{className:"ms-1",children:en?"已收藏":"收藏"}),W>0&&(0,t.jsx)("span",{className:"ms-1",children:W})]}),!A&&(0,t.jsxs)(c.Z,{className:"bottom-share-wrap",children:[(0,t.jsx)(c.Z.Toggle,{as:"div",className:"nav-tab-item btn d-flex justify-content-center align-items-center",children:(0,t.jsxs)(r.Z,{className:"btn rounded",variant:"outline-secondary",children:[(0,t.jsx)("i",{className:"far fa-share-nodes"}),(0,t.jsx)("span",{className:"ms-1",children:"分享"})]})}),(0,t.jsx)(c.Z.Menu,{className:"dropdown-menu-down",children:e_})]})]})}):"fixBottom"===a&&(eI=(0,t.jsxs)("div",{className:"w-100 fixed-bottom-action d-flex align-items-center ",children:["article"===Z&&(0,t.jsxs)(r.Z,{variant:"link",className:"btn-reset text-center text-body w-25",onClick:ey,"aria-label":"点赞",children:[es?(0,t.jsx)("i",{className:"fas fa-thumbs-up"}):(0,t.jsx)("i",{className:"far fa-thumbs-up"}),J>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:J})]}),"question"===Z&&(0,t.jsxs)(r.Z,{variant:"link",className:"btn-reset text-center text-body w-25",onClick:e=>{e.preventDefault()},"aria-label":"浏览",children:[(0,t.jsx)("i",{className:"far fa-eye"}),E>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:E})]}),(0,t.jsxs)(r.Z,{variant:"link",className:"btn-reset text-center text-body w-25",onClick:e=>{e.preventDefault(),eg()},"aria-label":"收藏",children:[en?(0,t.jsx)("i",{className:"fas fa-bookmark"}):(0,t.jsx)("i",{className:"far fa-bookmark"}),W>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:W})]}),(0,t.jsxs)("a",{className:"text-center text-body w-25",href:"#comment-area",children:[(0,t.jsx)("i",{className:"far fa-message-lines"}),X>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:X})]}),!A&&ej&&(0,t.jsx)(r.Z,{variant:"link",className:"btn-reset text-center text-body w-25","aria-label":"分享",onClick:e=>{e.preventDefault(),eS()},children:(0,t.jsx)("i",{className:"far fa-share-nodes text-body"})}),!A&&!ej&&(0,t.jsxs)(c.Z,{className:"bottom-share-wrap  w-25 text-center",children:[(0,t.jsx)(c.Z.Toggle,{variant:"link",className:"btn-reset","aria-label":"分享",children:(0,t.jsx)("i",{className:"far fa-share-nodes text-body"})}),(0,t.jsx)(c.Z.Menu,{className:"dropdown-menu-down",children:e_})]})]})),(0,t.jsxs)(t.Fragment,{children:[eI,(0,t.jsx)(b.Z,{id:s,isShow:ec,setShowStatus:el,setBookmarkedState:eZ,source:Z,isBookmarked:$}),(0,t.jsx)("canvas",{hidden:!0,className:"qrcode"})]})};a.Z=(0,x.$j)(e=>{let{global:a}=e;return{isBaiduOxApp:a.isBaiduOxApp,sessionUser:a.sessionUser}})(n.memo(w))},46543:function(e,a,s){var t=s(11527),n=s(19803),i=s.n(n),c=s(50959),l=s(80850);let r=(e,a)=>{let{children:s,onClick:n,className:c,domType:r="a"}=e;return"a"===r?(0,t.jsx)(l.Z,{variant:"link",className:i()("btn-reset",c),ref:a,onClick:e=>{e.preventDefault(),n(e)},children:s}):"button"===r?(0,t.jsx)("button",{className:c,ref:a,onClick:e=>{e.preventDefault(),n(e)}}):(0,t.jsx)("div",{className:c,ref:a,onClick:e=>{e.preventDefault(),n(e)},children:s})};a.Z=c.forwardRef(r)},64376:function(e,a,s){var t=s(11527),n=s(50959),i=s(9718),c=s(54599),l=s(5907),r=s(68188),o=s(37237),m=s(90484);let d=e=>{let{id:a,setBookmarkedState:s,isShow:l,setShowStatus:d,sessionUser:u,source:h="",isBookmarked:x=!1}=e,[f,b]=(0,n.useState)(!1),[k,j]=(0,n.useState)([]),[p,v]=(0,n.useState)([]),[N,w]=(0,n.useState)({value:"",isInvalid:!1,errorMsg:""}),[y,g]=(0,n.useState)(""),[Z,C]=(0,n.useState)(1);(0,n.useEffect)(()=>{u&&l&&S()},[l]);let S=async()=>{let e=await (0,m.XxZ)({objectId:a});(null==e?void 0:e.rows)&&(j(e.rows),v(e.rows.filter(e=>e.is_bookmarked).map(e=>e.id)))},L=()=>{d(!1),b(!1),w({value:"",isInvalid:!1,errorMsg:""}),g(""),C(1)},_=e=>{e.is_bookmarked?v(p.filter(a=>a!==e.id)):v([...p,e.id]),j(k.map(a=>(e.id===a.id&&(a.is_bookmarked=e.is_bookmarked?0:1),a)))},I=async()=>{if(f){if(!N.value){w({...N,isInvalid:!0,errorMsg:"名称必填"});return}await (0,m.Tlc)({name:N.value,description:y,is_private:Z}).catch(e=>{if(null==e?void 0:e.isError){w({...N,isInvalid:!0,errorMsg:e.name});return}}),S(),b(!f)}else(0,m.vjt)({type:h,id:a,is_bookmark:0===p.length?0:1,archive_ids:p}).catch(()=>{s(!1)}),!!p.length!==x&&s(0!==p.length),d(!1)};return(0,t.jsx)(o.Z,{scrollable:!0,show:l,title:f?"创建收藏夹":"收藏",onCancel:L,onOk:I,children:f?(0,t.jsxs)(r.Z,{className:"bookmarklist-form",id:"bookmarkArchives",onSubmit:I,children:[(0,t.jsxs)(i.Z,{controlId:"bookmark.archiveName",className:"mb-3",children:[(0,t.jsx)(c.Z.Label,{className:"required",children:"名称"})," ",(0,t.jsx)(c.Z.Control,{type:"text",className:"form-control",value:N.value,onChange:e=>w({...N,value:e.target.value}),placeholder:"最多输入32个字",maxLength:32,autoComplete:"off",required:!0,isInvalid:N.isInvalid}),(0,t.jsx)(c.Z.Control.Feedback,{type:"invalid",children:N.errorMsg})]}),(0,t.jsxs)(i.Z,{controlId:"bookmark.description",className:"mb-3",children:[(0,t.jsx)(c.Z.Label,{children:"描述"})," ",(0,t.jsx)(c.Z.Control,{as:"textarea",value:y,onChange:e=>g(e.target.value),placeholder:"最多输入256个字",maxLength:256})]}),(0,t.jsxs)("div",{className:"form-check",children:[(0,t.jsx)("input",{className:"form-check-input",type:"radio",name:"isPrivate",value:"1",onChange:()=>C(1),checked:1===Z,id:"bookmark-private"}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"bookmark-private",children:"私密："}),(0,t.jsx)("span",{className:"text-secondary",children:"仅自己可见"})]}),(0,t.jsxs)("div",{className:"form-check",children:[(0,t.jsx)("input",{className:"form-check-input",type:"radio",name:"isPrivate",onChange:()=>C(0),checked:0===Z,id:"bookmark-public"}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"bookmark-public",children:"公开："}),(0,t.jsx)("span",{className:"text-secondary",children:"公开后不可再设置为私密"})]})]}):(0,t.jsx)(r.Z,{onSubmit:I,children:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-title",children:"添加到收藏夹："}),null==k?void 0:k.map(e=>(0,t.jsxs)("div",{className:"form-check mb-2",children:[(0,t.jsx)("input",{className:"form-check-input",type:"checkbox",name:"bookmarkItem[]",id:e.id,value:e.id,onChange:()=>_(e),checked:!!e.is_bookmarked}),(0,t.jsxs)("label",{className:"form-check-label",htmlFor:e.id,children:[e.name,!!e.is_private&&(0,t.jsx)("span",{className:"text-secondary",children:"（私密）"})]})]},e.id)),(0,t.jsx)("button",{className:"btn btn-link new-bookmark p-0",onClick:()=>b(!0),children:"+ 创建收藏夹"})]})})})};a.Z=(0,l.$j)(e=>{let{global:a}=e;return{sessionUser:a.sessionUser}})(n.memo(d))}}]);